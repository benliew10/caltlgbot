# Telegram 记账机器人

这是一个 Telegram 记账机器人，用于在群组中记录每日交易，并在每天自动重置账单。

## 功能特点

- 记录入款（存款）
- 记录下发（提款）  
- 记录用户分类及余额
- 设置费率和固定汇率
- 显示日账单汇总
- 每天自动重置账单
- 支持手动重置账单
- 操作人权限管理

## 安装和设置

1. 确保已安装 Python 3.7 或更高版本
2. 安装所需的依赖包：
   ```
   pip install -r requirements.txt
   ```
3. 在 Telegram 中找 BotFather 创建一个新的机器人，并获取 API token
4. 配置机器人:
   - 将 `config_template.py` 复制并重命名为 `config.py`
   - 在 `config.py` 中替换 "YOUR_TELEGRAM_BOT_TOKEN" 为您的实际 Token
   - 如果需要，可以设置 `ADMIN_USER_ID` 为您的 Telegram 用户 ID
   - 如果需要，可以在 `INITIAL_OPERATORS` 列表中添加初始操作人的用户名
5. 运行机器人：
   ```
   python accounting_bot.py
   ```
6. 在机器人启动后，如果未预设管理员，第一个使用 `/set_admin` 命令的用户将成为管理员

## 配置说明

配置文件 `config.py` 包含以下设置项:

- `BOT_TOKEN`: Telegram 机器人的 API 令牌
- `ADMIN_USER_ID`: 管理员的 Telegram 用户 ID（可选）
- `INITIAL_OPERATORS`: 初始操作人用户名列表
- `TIMEZONE`: 时区设置，默认为 "Asia/Shanghai"
- `RESET_CHECK_INTERVAL`: 每日重置检查间隔（秒）

## 使用方法

机器人支持以下命令：

### 标准命令
- `/deposit [金额]` - 记录入款
- `/withdraw [金额]` - 记录下发
- `/user [用户ID] [上分金额] [下分金额]` - 记录用户分类
- `/rate [费率百分比]` - 设置费率
- `/fixed_rate [固定汇率]` - 设置固定汇率
- `/summary` - 显示当前账单汇总
- `/reset` - 手动重置账单（通常每天自动重置）
- `/help` - 查看帮助信息
- `/set_admin` - 设置自己为管理员（仅首次使用时有效）

### 快捷命令
- `+[金额]` - 增加入款记录 (例如: +180)
- `-[金额]` - 减掉入款记录 (例如: -50)
- `+[金额]/[汇率]` - 增加入款记录并指定汇率 (例如: +200/1.2)
- `-[金额]/[汇率]` - 减掉入款记录并指定汇率 (例如: -100/1.2)
- `回[金额]` - 增加下发记录 (例如: 回180)
- `下发[金额]` - 增加下发记录 (例如: 下发180)

### 设置指令
- `设置费率[数字]%` - 设置费率百分比 (例如: 设置费率5%)
- `设置汇率[数字]` - 设置固定汇率 (例如: 设置汇率6.8)
- `设置实时汇率` - 设置使用实时汇率（目前暂不支持）

### 管理员指令
- `重置授权人` - 重置所有授权人
- `设置操作人 @xxx` - 添加操作人 (例如: 设置操作人 @username)
- `删除操作人 @xxx` - 删除操作人 (例如: 删除操作人 @username)
- `清空操作人` - 清空所有操作人
- `显示操作人` - 显示当前操作人列表

## 权限管理

机器人有两种角色：
1. **管理员** - 可以管理操作人，只能有一个
2. **操作人** - 可以使用机器人的所有记账功能

只有操作人和管理员可以使用机器人，普通用户无法触发机器人功能。
默认情况下，如果没有设置操作人，只有 `/set_admin` 命令可以被任何人使用。

## 输出格式

机器人的账单输出格式如下：

```
入款 (X笔):
HH:MM 金额/1.0=金额U

分类 (X人):
🔼上分 🔽下分U 💰 余额U👤用户ID

下发 (X笔):
HH:MM 金额/1.0=金额U

费率: X%
固定汇率: X
总入款: X
应下发: X | XU
已下发: X | XU
未下发: X | XU
``` 